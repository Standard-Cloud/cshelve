services:
  azurite:
    image: mcr.microsoft.com/azure-storage/azurite
    ports:
      - "10000:10000"
      - "10001:10001"
      - "10002:10002"

  minio:
    image: quay.io/minio/minio
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ACCESS_KEY: "minio"
      MINIO_SECRET_KEY: "minio123"
    command: server /data --console-address ":9001"

  cshelve:
    user: "1000:1000"
    build:
      context: ..
      dockerfile: ./.devcontainer/Dockerfile

    ports:
      - "8000:8000"

    volumes:
      # Forwards the local Docker socket to the container.
      - /var/run/docker.sock:/var/run/docker-host.sock
      # Update this to wherever you want VS Code to mount the folder of your project
      - ..:/workspaces/package:cached

    depends_on:
      - azurite
      - minio

    command: sleep infinity
